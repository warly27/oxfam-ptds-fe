{"ast":null,"code":"import _regeneratorRuntime from \"/Users/wdelacruz/project_2021/matx-react/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/wdelacruz/project_2021/matx-react/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"/Users/wdelacruz/project_2021/matx-react/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _objectSpread from \"/Users/wdelacruz/project_2021/matx-react/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\n\nvar _jsxFileName = \"/Users/wdelacruz/project_2021/matx-react/src/app/contexts/JWTAuthContext.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { createContext, useEffect, useReducer } from 'react';\nimport jwtDecode from 'jwt-decode';\nimport axios from 'axios.js';\nimport { MatxLoading } from 'app/components';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar initialState = {\n  isAuthenticated: false,\n  isInitialised: false,\n  user: null\n};\n\nvar isValidToken = function isValidToken(accessToken) {\n  if (!accessToken) {\n    return false;\n  }\n\n  var decodedToken = jwtDecode(accessToken);\n  var currentTime = Date.now() / 1000;\n  return decodedToken.exp > currentTime;\n};\n\nvar setSession = function setSession(accessToken) {\n  if (accessToken) {\n    localStorage.setItem('accessToken', accessToken);\n    axios.defaults.headers.common.Authorization = \"Bearer \".concat(accessToken);\n  } else {\n    localStorage.removeItem('accessToken');\n    delete axios.defaults.headers.common.Authorization;\n  }\n};\n\nvar reducer = function reducer(state, action) {\n  switch (action.type) {\n    case 'INIT':\n      {\n        var _action$payload = action.payload,\n            isAuthenticated = _action$payload.isAuthenticated,\n            user = _action$payload.user;\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: isAuthenticated,\n          isInitialised: true,\n          user: user\n        });\n      }\n\n    case 'LOGIN':\n      {\n        var _user = action.payload.user;\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: true,\n          user: _user\n        });\n      }\n\n    case 'LOGOUT':\n      {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: false,\n          user: null\n        });\n      }\n\n    case 'REGISTER':\n      {\n        var _user2 = action.payload.user;\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: true,\n          user: _user2\n        });\n      }\n\n    default:\n      {\n        return _objectSpread({}, state);\n      }\n  }\n};\n\nvar AuthContext = /*#__PURE__*/createContext(_objectSpread(_objectSpread({}, initialState), {}, {\n  method: 'JWT',\n  login: function login() {\n    return Promise.resolve();\n  },\n  logout: function logout() {},\n  register: function register() {\n    return Promise.resolve();\n  }\n}));\nexport var AuthProvider = function AuthProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n\n  var _useReducer = useReducer(reducer, initialState),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      state = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var login = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(email, password) {\n      var response, _response$data, accessToken, user;\n\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return axios.post('/api/auth/login', {\n                email: email,\n                password: password\n              });\n\n            case 2:\n              response = _context.sent;\n              _response$data = response.data, accessToken = _response$data.accessToken, user = _response$data.user;\n              setSession(accessToken);\n              dispatch({\n                type: 'LOGIN',\n                payload: {\n                  user: user\n                }\n              });\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function login(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var register = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(email, username, password) {\n      var response, _response$data2, accessToken, user;\n\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return axios.post('/api/auth/register', {\n                email: email,\n                username: username,\n                password: password\n              });\n\n            case 2:\n              response = _context2.sent;\n              _response$data2 = response.data, accessToken = _response$data2.accessToken, user = _response$data2.user;\n              setSession(accessToken);\n              dispatch({\n                type: 'REGISTER',\n                payload: {\n                  user: user\n                }\n              });\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function register(_x3, _x4, _x5) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var logout = function logout() {\n    setSession(null);\n    dispatch({\n      type: 'LOGOUT'\n    });\n  };\n\n  useEffect(function () {\n    ;\n\n    _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n      var accessToken, response, user;\n      return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              accessToken = window.localStorage.getItem('accessToken');\n\n              if (!(accessToken && isValidToken(accessToken))) {\n                _context3.next = 11;\n                break;\n              }\n\n              setSession(accessToken);\n              _context3.next = 6;\n              return axios.get('/api/auth/profile');\n\n            case 6:\n              response = _context3.sent;\n              user = response.data.user;\n              dispatch({\n                type: 'INIT',\n                payload: {\n                  isAuthenticated: true,\n                  user: user\n                }\n              });\n              _context3.next = 12;\n              break;\n\n            case 11:\n              dispatch({\n                type: 'INIT',\n                payload: {\n                  isAuthenticated: false,\n                  user: null\n                }\n              });\n\n            case 12:\n              _context3.next = 18;\n              break;\n\n            case 14:\n              _context3.prev = 14;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.error(_context3.t0);\n              dispatch({\n                type: 'INIT',\n                payload: {\n                  isAuthenticated: false,\n                  user: null\n                }\n              });\n\n            case 18:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 14]]);\n    }))();\n  }, []);\n\n  if (!state.isInitialised) {\n    return /*#__PURE__*/_jsxDEV(MatxLoading, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 16\n    }, _this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: _objectSpread(_objectSpread({}, state), {}, {\n      method: 'JWT',\n      login: login,\n      logout: logout,\n      register: register\n    }),\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 171,\n    columnNumber: 9\n  }, _this);\n};\n\n_s(AuthProvider, \"bgCdjuTOmPdSBRwTap80EFd9Y3U=\");\n\n_c = AuthProvider;\nexport default AuthContext;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useEffect","useReducer","jwtDecode","axios","MatxLoading","initialState","isAuthenticated","isInitialised","user","isValidToken","accessToken","decodedToken","currentTime","Date","now","exp","setSession","localStorage","setItem","defaults","headers","common","Authorization","removeItem","reducer","state","action","type","payload","AuthContext","method","login","Promise","resolve","logout","register","AuthProvider","children","dispatch","email","password","post","response","data","username","window","getItem","get","console","error"],"sources":["/Users/wdelacruz/project_2021/matx-react/src/app/contexts/JWTAuthContext.js"],"sourcesContent":["import React, { createContext, useEffect, useReducer } from 'react'\nimport jwtDecode from 'jwt-decode'\nimport axios from 'axios.js'\nimport { MatxLoading } from 'app/components'\n\nconst initialState = {\n    isAuthenticated: false,\n    isInitialised: false,\n    user: null,\n}\n\nconst isValidToken = (accessToken) => {\n    if (!accessToken) {\n        return false\n    }\n\n    const decodedToken = jwtDecode(accessToken)\n    const currentTime = Date.now() / 1000\n    return decodedToken.exp > currentTime\n}\n\nconst setSession = (accessToken) => {\n    if (accessToken) {\n        localStorage.setItem('accessToken', accessToken)\n        axios.defaults.headers.common.Authorization = `Bearer ${accessToken}`\n    } else {\n        localStorage.removeItem('accessToken')\n        delete axios.defaults.headers.common.Authorization\n    }\n}\n\nconst reducer = (state, action) => {\n    switch (action.type) {\n        case 'INIT': {\n            const { isAuthenticated, user } = action.payload\n\n            return {\n                ...state,\n                isAuthenticated,\n                isInitialised: true,\n                user,\n            }\n        }\n        case 'LOGIN': {\n            const { user } = action.payload\n\n            return {\n                ...state,\n                isAuthenticated: true,\n                user,\n            }\n        }\n        case 'LOGOUT': {\n            return {\n                ...state,\n                isAuthenticated: false,\n                user: null,\n            }\n        }\n        case 'REGISTER': {\n            const { user } = action.payload\n\n            return {\n                ...state,\n                isAuthenticated: true,\n                user,\n            }\n        }\n        default: {\n            return { ...state }\n        }\n    }\n}\n\nconst AuthContext = createContext({\n    ...initialState,\n    method: 'JWT',\n    login: () => Promise.resolve(),\n    logout: () => { },\n    register: () => Promise.resolve(),\n})\n\nexport const AuthProvider = ({ children }) => {\n    const [state, dispatch] = useReducer(reducer, initialState)\n\n    const login = async (email, password) => {\n        const response = await axios.post('/api/auth/login', {\n            email,\n            password,\n        })\n        const { accessToken, user } = response.data\n\n        setSession(accessToken)\n\n        dispatch({\n            type: 'LOGIN',\n            payload: {\n                user,\n            },\n        })\n    }\n\n    const register = async (email, username, password) => {\n        const response = await axios.post('/api/auth/register', {\n            email,\n            username,\n            password,\n        })\n\n        const { accessToken, user } = response.data\n\n        setSession(accessToken)\n\n        dispatch({\n            type: 'REGISTER',\n            payload: {\n                user,\n            },\n        })\n    }\n\n    const logout = () => {\n        setSession(null)\n        dispatch({ type: 'LOGOUT' })\n    }\n\n    useEffect(() => {\n        ; (async () => {\n            try {\n                const accessToken = window.localStorage.getItem('accessToken')\n\n                if (accessToken && isValidToken(accessToken)) {\n                    setSession(accessToken)\n                    const response = await axios.get('/api/auth/profile')\n                    const { user } = response.data\n\n                    dispatch({\n                        type: 'INIT',\n                        payload: {\n                            isAuthenticated: true,\n                            user,\n                        },\n                    })\n                } else {\n                    dispatch({\n                        type: 'INIT',\n                        payload: {\n                            isAuthenticated: false,\n                            user: null,\n                        },\n                    })\n                }\n            } catch (err) {\n                console.error(err)\n                dispatch({\n                    type: 'INIT',\n                    payload: {\n                        isAuthenticated: false,\n                        user: null,\n                    },\n                })\n            }\n        })()\n    }, [])\n\n    if (!state.isInitialised) {\n        return <MatxLoading />\n    }\n\n    return (\n        <AuthContext.Provider\n            value={{\n                ...state,\n                method: 'JWT',\n                login,\n                logout,\n                register,\n            }}\n        >\n            {children}\n        </AuthContext.Provider>\n    )\n}\n\nexport default AuthContext\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}