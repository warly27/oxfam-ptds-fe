{"ast":null,"code":"import _regeneratorRuntime from \"/Users/wdelacruz/project_2021/oxfam-fe/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/wdelacruz/project_2021/oxfam-fe/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"/Users/wdelacruz/project_2021/oxfam-fe/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _objectSpread from \"/Users/wdelacruz/project_2021/oxfam-fe/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\n\nvar _jsxFileName = \"/Users/wdelacruz/project_2021/oxfam-fe/src/app/contexts/JWTAuthContext.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { createContext, useEffect, useReducer } from 'react';\nimport jwtDecode from 'jwt-decode';\nimport axios from 'axios.js';\nimport { MatxLoading } from 'app/components';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar initialState = {\n  isAuthenticated: false,\n  isInitialised: false,\n  user: null\n};\n\nvar isValidToken = function isValidToken(accessToken) {\n  if (!accessToken) {\n    return false;\n  }\n\n  var decodedToken = jwtDecode(accessToken);\n  var currentTime = Date.now() / 1000;\n  return decodedToken.exp > currentTime;\n};\n\nvar setSession = function setSession(accessToken) {\n  if (accessToken) {\n    localStorage.setItem('accessToken', accessToken);\n    axios.defaults.headers.common.Authorization = \"Bearer \".concat(accessToken);\n  } else {\n    localStorage.removeItem('accessToken');\n    delete axios.defaults.headers.common.Authorization;\n  }\n};\n\nvar reducer = function reducer(state, action) {\n  switch (action.type) {\n    case 'INIT':\n      {\n        var _action$payload = action.payload,\n            isAuthenticated = _action$payload.isAuthenticated,\n            user = _action$payload.user;\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: isAuthenticated,\n          isInitialised: true,\n          user: user\n        });\n      }\n\n    case 'LOGIN':\n      {\n        var _user = action.payload.user;\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: true,\n          user: _user\n        });\n      }\n\n    case 'LOGOUT':\n      {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: false,\n          user: null\n        });\n      }\n\n    case 'REGISTER':\n      {\n        var _user2 = action.payload.user;\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: true,\n          user: _user2\n        });\n      }\n\n    default:\n      {\n        return _objectSpread({}, state);\n      }\n  }\n};\n\nvar AuthContext = /*#__PURE__*/createContext(_objectSpread(_objectSpread({}, initialState), {}, {\n  method: 'JWT',\n  login: function login() {\n    return Promise.resolve();\n  },\n  logout: function logout() {},\n  register: function register() {\n    return Promise.resolve();\n  }\n}));\nexport var AuthProvider = function AuthProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n\n  var _useReducer = useReducer(reducer, initialState),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      state = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var login = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(email, password) {\n      var response, _response$data, accessToken, user;\n\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return axios.post('https://1co5vgnfk7.execute-api.ap-southeast-1.amazonaws.com/dev/v1/auth/login', //   '/api/auth/login',\n              {\n                email: email,\n                password: password\n              });\n\n            case 2:\n              response = _context.sent;\n              console.log(response.data);\n              _response$data = response.data, accessToken = _response$data.accessToken, user = _response$data.user;\n              setSession(accessToken);\n              dispatch({\n                type: 'LOGIN',\n                payload: {\n                  user: user\n                }\n              });\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function login(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var register = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(email, username, password) {\n      var response, _response$data2, accessToken, user;\n\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return axios.post('/api/auth/register', {\n                email: email,\n                username: username,\n                password: password\n              });\n\n            case 2:\n              response = _context2.sent;\n              _response$data2 = response.data, accessToken = _response$data2.accessToken, user = _response$data2.user;\n              setSession(accessToken);\n              dispatch({\n                type: 'REGISTER',\n                payload: {\n                  user: user\n                }\n              });\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function register(_x3, _x4, _x5) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var logout = function logout() {\n    setSession(null);\n    dispatch({\n      type: 'LOGOUT'\n    });\n  };\n\n  useEffect(function () {\n    _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n      var accessToken, response, user;\n      return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              accessToken = window.localStorage.getItem('accessToken');\n\n              if (!(accessToken && isValidToken(accessToken))) {\n                _context3.next = 11;\n                break;\n              }\n\n              setSession(accessToken);\n              _context3.next = 6;\n              return axios.get('/api/auth/profile');\n\n            case 6:\n              response = _context3.sent;\n              user = response.data.user;\n              dispatch({\n                type: 'INIT',\n                payload: {\n                  isAuthenticated: true,\n                  user: user\n                }\n              });\n              _context3.next = 12;\n              break;\n\n            case 11:\n              dispatch({\n                type: 'INIT',\n                payload: {\n                  isAuthenticated: false,\n                  user: null\n                }\n              });\n\n            case 12:\n              _context3.next = 18;\n              break;\n\n            case 14:\n              _context3.prev = 14;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.error(_context3.t0);\n              dispatch({\n                type: 'INIT',\n                payload: {\n                  isAuthenticated: false,\n                  user: null\n                }\n              });\n\n            case 18:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 14]]);\n    }))();\n  }, []);\n\n  if (!state.isInitialised) {\n    return /*#__PURE__*/_jsxDEV(MatxLoading, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 12\n    }, _this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: _objectSpread(_objectSpread({}, state), {}, {\n      method: 'JWT',\n      login: login,\n      logout: logout,\n      register: register\n    }),\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 177,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(AuthProvider, \"bgCdjuTOmPdSBRwTap80EFd9Y3U=\");\n\n_c = AuthProvider;\nexport default AuthContext;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useEffect","useReducer","jwtDecode","axios","MatxLoading","initialState","isAuthenticated","isInitialised","user","isValidToken","accessToken","decodedToken","currentTime","Date","now","exp","setSession","localStorage","setItem","defaults","headers","common","Authorization","removeItem","reducer","state","action","type","payload","AuthContext","method","login","Promise","resolve","logout","register","AuthProvider","children","dispatch","email","password","post","response","console","log","data","username","window","getItem","get","error"],"sources":["/Users/wdelacruz/project_2021/oxfam-fe/src/app/contexts/JWTAuthContext.js"],"sourcesContent":["import React, { createContext, useEffect, useReducer } from 'react';\nimport jwtDecode from 'jwt-decode';\nimport axios from 'axios.js';\nimport { MatxLoading } from 'app/components';\n\nconst initialState = {\n  isAuthenticated: false,\n  isInitialised: false,\n  user: null,\n};\n\nconst isValidToken = (accessToken) => {\n  if (!accessToken) {\n    return false;\n  }\n\n  const decodedToken = jwtDecode(accessToken);\n  const currentTime = Date.now() / 1000;\n  return decodedToken.exp > currentTime;\n};\n\nconst setSession = (accessToken) => {\n  if (accessToken) {\n    localStorage.setItem('accessToken', accessToken);\n    axios.defaults.headers.common.Authorization = `Bearer ${accessToken}`;\n  } else {\n    localStorage.removeItem('accessToken');\n    delete axios.defaults.headers.common.Authorization;\n  }\n};\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'INIT': {\n      const { isAuthenticated, user } = action.payload;\n\n      return {\n        ...state,\n        isAuthenticated,\n        isInitialised: true,\n        user,\n      };\n    }\n    case 'LOGIN': {\n      const { user } = action.payload;\n\n      return {\n        ...state,\n        isAuthenticated: true,\n        user,\n      };\n    }\n    case 'LOGOUT': {\n      return {\n        ...state,\n        isAuthenticated: false,\n        user: null,\n      };\n    }\n    case 'REGISTER': {\n      const { user } = action.payload;\n\n      return {\n        ...state,\n        isAuthenticated: true,\n        user,\n      };\n    }\n    default: {\n      return { ...state };\n    }\n  }\n};\n\nconst AuthContext = createContext({\n  ...initialState,\n  method: 'JWT',\n  login: () => Promise.resolve(),\n  logout: () => {},\n  register: () => Promise.resolve(),\n});\n\nexport const AuthProvider = ({ children }) => {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  const login = async (email, password) => {\n    const response = await axios.post(\n      'https://1co5vgnfk7.execute-api.ap-southeast-1.amazonaws.com/dev/v1/auth/login',\n      //   '/api/auth/login',\n      {\n        email,\n        password,\n      }\n    );\n\n    console.log(response.data);\n    const { accessToken, user } = response.data;\n\n    setSession(accessToken);\n\n    dispatch({\n      type: 'LOGIN',\n      payload: {\n        user,\n      },\n    });\n  };\n\n  const register = async (email, username, password) => {\n    const response = await axios.post('/api/auth/register', {\n      email,\n      username,\n      password,\n    });\n\n    const { accessToken, user } = response.data;\n\n    setSession(accessToken);\n\n    dispatch({\n      type: 'REGISTER',\n      payload: {\n        user,\n      },\n    });\n  };\n\n  const logout = () => {\n    setSession(null);\n    dispatch({ type: 'LOGOUT' });\n  };\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const accessToken = window.localStorage.getItem('accessToken');\n\n        if (accessToken && isValidToken(accessToken)) {\n          setSession(accessToken);\n          const response = await axios.get('/api/auth/profile');\n          const { user } = response.data;\n\n          dispatch({\n            type: 'INIT',\n            payload: {\n              isAuthenticated: true,\n              user,\n            },\n          });\n        } else {\n          dispatch({\n            type: 'INIT',\n            payload: {\n              isAuthenticated: false,\n              user: null,\n            },\n          });\n        }\n      } catch (err) {\n        console.error(err);\n        dispatch({\n          type: 'INIT',\n          payload: {\n            isAuthenticated: false,\n            user: null,\n          },\n        });\n      }\n    })();\n  }, []);\n\n  if (!state.isInitialised) {\n    return <MatxLoading />;\n  }\n\n  return (\n    <AuthContext.Provider\n      value={{\n        ...state,\n        method: 'JWT',\n        login,\n        logout,\n        register,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthContext;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}